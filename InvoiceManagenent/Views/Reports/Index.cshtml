@{
    ViewData["Title"] = "Reports Dashboard";
    var monthlyLabels = ViewBag.MonthlySalesLabels as List<string>;
    var monthlyValues = ViewBag.MonthlySalesValues as List<decimal>;
    var topProducts = ViewBag.TopProducts;
    var lowStock = ViewBag.LowStock;
    var topCustomers = ViewBag.TopCustomers;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container mt-4">
    <h1 class="text-center mb-4 fw-bold">📊 Reports Dashboard</h1>

    <div class="alert alert-success text-center shadow-sm">
        <h3>Total Revenue: $@ViewBag.TotalRevenue.ToString("N2")</h3>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5><i class="bi bi-graph-up me-2"></i>Monthly Sales</h5>
                </div>
                <div class="card-body">
                    <canvas id="salesChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5><i class="bi bi-bar-chart me-2"></i>Top 5 Selling Products</h5>
                </div>
                <div class="card-body">
                    <canvas id="topProductsChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4 shadow-sm">
        <div class="card-header bg-success text-white">
            <h5><i class="bi bi-person-lines-fill me-2"></i>Top Customers</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Customer</th>
                        <th>Total Spent ($)</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var c in ViewBag.TopCustomers)
                    {
                        <tr>
                            <td>@c.Customer</td>
                            <td>@c.TotalSpent.ToString("N2")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="card mt-4 shadow-sm">
        <div class="card-header bg-danger text-white">
            <h5><i class="bi bi-exclamation-triangle me-2"></i>Low Stock Products</h5>
        </div>
        <div class="card-body">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Stock</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in ViewBag.LowStock)
                    {
                        <tr>
                            <td>@p.ProductName</td>
                            <td>@p.Stock</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const monthlyLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(monthlyLabels));
    const monthlyValues = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(monthlyValues));
    const topProducts = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
        ((IEnumerable<dynamic>)ViewBag.TopProducts).Select(x => x.Product)));
    const topProductValues = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
        ((IEnumerable<dynamic>)ViewBag.TopProducts).Select(x => x.Revenue)));

    new Chart(document.getElementById("salesChart"), {
        type: "line",
        data: {
            labels: monthlyLabels,
            datasets: [{
                label: "Revenue ($)",
                data: monthlyValues,
                borderColor: "#28a745",
                backgroundColor: "rgba(40,167,69,0.2)",
                fill: true,
                tension: 0.3
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });

    new Chart(document.getElementById("topProductsChart"), {
        type: "bar",
        data: {
            labels: topProducts,
            datasets: [{
                label: "Revenue ($)",
                data: topProductValues,
                backgroundColor: "#007bff"
            }]
        },
        options: { scales: { y: { beginAtZero: true } } }
    });
</script>
